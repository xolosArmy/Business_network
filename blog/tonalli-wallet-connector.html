<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reporte T√©cnico: WalletConnect v2 en xolosArmy</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- Chosen Palette: Warm Tech - Background: Stone-50, Primary: Slate-800, Accent: Amber-500, Text: Gray-800 -->
    <style>
        body {
            font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            background-color: #fafaf9; /* stone-50 */
            color: #1f2937; /* gray-800 */
        }
        .chart-container {
            position: relative;
            width: 100%;
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
            height: 300px;
            max-height: 400px;
        }
        @media (min-width: 768px) {
            .chart-container {
                height: 350px;
            }
        }
        .step-active {
            border-color: #f59e0b; /* amber-500 */
            background-color: #fffbeb; /* amber-50 */
            transform: scale(1.02);
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }
        .connector-line {
            transition: all 0.5s ease;
        }
        .highlight-text {
            background-color: #fef3c7;
            padding: 0 4px;
            border-radius: 2px;
        }
    </style>
</head>
<body class="bg-stone-50 text-gray-800">

    <!-- Navigation / Header -->
    <nav class="bg-slate-800 text-white p-4 shadow-lg sticky top-0 z-50">
        <div class="container mx-auto flex justify-between items-center">
            <div class="flex items-center space-x-2">
                <div class="w-3 h-3 bg-green-400 rounded-full animate-pulse"></div>
                <h1 class="text-xl font-bold tracking-wider">XOLOSARMY RESEARCH</h1>
            </div>
            <div class="hidden md:flex space-x-6 text-sm font-medium">
                <a href="#dashboard" class="hover:text-amber-400 transition">Dashboard</a>
                <a href="#architecture" class="hover:text-amber-400 transition">Arquitectura</a>
                <a href="#simulation" class="hover:text-amber-400 transition">Simulaci√≥n</a>
                <a href="#deep-dive" class="hover:text-amber-400 transition">Componentes</a>
            </div>
            <button id="mobile-menu-btn" class="md:hidden text-white focus:outline-none">
                ‚ò∞
            </button>
        </div>
        <!-- Mobile Menu -->
        <div id="mobile-menu" class="hidden md:hidden bg-slate-700 p-4 mt-2 rounded">
            <a href="#dashboard" class="block py-2 hover:text-amber-400">Dashboard</a>
            <a href="#architecture" class="block py-2 hover:text-amber-400">Arquitectura</a>
            <a href="#simulation" class="block py-2 hover:text-amber-400">Simulaci√≥n</a>
            <a href="#deep-dive" class="block py-2 hover:text-amber-400">Componentes</a>
        </div>
    </nav>

    <!-- Main Content Container -->
    <main class="container mx-auto px-4 py-8 space-y-16 max-w-6xl">

        <!-- Hero Section -->
        <header class="text-center space-y-4">
            <span class="inline-block px-3 py-1 bg-amber-100 text-amber-800 rounded-full text-xs font-bold uppercase tracking-wide border border-amber-200">Informe T√©cnico ‚Ä¢ 6 Feb 2026</span>
            <h1 class="text-4xl md:text-5xl font-extrabold text-slate-900 leading-tight">Arquitectura de Conectividad eCash<br><span class="text-amber-600">WalletConnect v2</span></h1>
            <p class="text-lg text-gray-600 max-w-2xl mx-auto">
                An√°lisis detallado de la migraci√≥n hacia una infraestructura RPC persistente entre <strong>Xolo Legend</strong> y <strong>RMZWallet</strong>.
            </p>
        </header>

        <!-- Section 1: Dashboard Overview -->
        <section id="dashboard" class="bg-white rounded-2xl shadow-sm border border-stone-200 p-6 md:p-8">
            <div class="grid md:grid-cols-2 gap-8 items-center">
                <div class="space-y-4">
                    <h2 class="text-2xl font-bold text-slate-800 border-l-4 border-amber-500 pl-4">Resumen Ejecutivo</h2>
                    <p class="text-gray-600 leading-relaxed">
                        Este reporte documenta la implementaci√≥n exitosa y bidireccional del protocolo WalletConnect v2 en el ecosistema xolosArmy. Se ha reemplazado el modelo antiguo de "callbacks" por una <strong>mensajer√≠a RPC persistente</strong>, permitiendo una experiencia de usuario fluida y segura.
                    </p>
                    <ul class="space-y-2 text-sm text-gray-700">
                        <li class="flex items-start">
                            <span class="text-green-500 mr-2">‚úì</span>
                            <span><strong>Delegaci√≥n Segura:</strong> Firma Schnorr sin exponer llaves privadas.</span>
                        </li>
                        <li class="flex items-start">
                            <span class="text-green-500 mr-2">‚úì</span>
                            <span><strong>Sincronizaci√≥n Real:</strong> Actualizaci√≥n de estado sin recargas.</span>
                        </li>
                        <li class="flex items-start">
                            <span class="text-green-500 mr-2">‚úì</span>
                            <span><strong>Interoperabilidad:</strong> Est√°ndar eCAIP-25.</span>
                        </li>
                    </ul>
                </div>
                <div class="bg-stone-50 rounded-xl p-4 border border-stone-100">
                    <h3 class="text-sm font-semibold text-gray-500 mb-4 text-center">Comparativa: Legacy vs Implementaci√≥n v2</h3>
                    <div class="chart-container">
                        <canvas id="comparisonChart"></canvas>
                    </div>
                    <p class="text-xs text-center text-gray-400 mt-2">Evaluaci√≥n basada en m√©tricas de rendimiento y seguridad.</p>
                </div>
            </div>
        </section>

        <!-- Section 2: Architecture Diagram (Interactive) -->
        <section id="architecture" class="space-y-6">
            <div class="max-w-3xl mx-auto text-center">
                <h2 class="text-2xl font-bold text-slate-800">Mapa de Arquitectura del Sistema</h2>
                <p class="text-gray-600 mt-2">
                    Explore la relaci√≥n entre la dApp y el Wallet. Haga clic en los componentes para ver detalles t√©cnicos de la implementaci√≥n.
                </p>
            </div>

            <!-- Interactive Architecture Layout -->
            <div class="grid md:grid-cols-3 gap-4 relative bg-slate-100 rounded-2xl p-8 border border-slate-200">
                
                <!-- Connection Line (Visual only) -->
                <div class="hidden md:block absolute top-1/2 left-0 w-full h-1 bg-gray-300 -z-0 transform -translate-y-1/2"></div>

                <!-- Node: dApp -->
                <div onclick="showArchDetail('dapp')" class="cursor-pointer bg-white p-6 rounded-xl shadow-md border-b-4 border-blue-500 hover:-translate-y-1 transition relative z-10 group">
                    <div class="text-4xl mb-2 text-center">üíª</div>
                    <h3 class="font-bold text-center text-slate-800">Xolo Legend (dApp)</h3>
                    <p class="text-xs text-center text-gray-500 mt-1">Sign Client & UI</p>
                    <div class="mt-4 text-xs text-blue-600 font-mono bg-blue-50 p-2 rounded text-center opacity-0 group-hover:opacity-100 transition">
                        ecash:mainnet<br>@walletconnect/sign-client
                    </div>
                </div>

                <!-- Node: Relay -->
                <div onclick="showArchDetail('relay')" class="cursor-pointer bg-slate-800 p-6 rounded-xl shadow-md border-b-4 border-purple-500 hover:-translate-y-1 transition relative z-10 group">
                    <div class="text-4xl mb-2 text-center">‚òÅÔ∏è</div>
                    <h3 class="font-bold text-center text-white">WC Cloud Relay</h3>
                    <p class="text-xs text-center text-gray-400 mt-1">Puente Encriptado</p>
                    <div class="mt-4 text-xs text-purple-300 font-mono bg-slate-700 p-2 rounded text-center opacity-0 group-hover:opacity-100 transition">
                        Topic: xololegend_wallet_session<br>WebSocket Tunnel
                    </div>
                </div>

                <!-- Node: Wallet -->
                <div onclick="showArchDetail('wallet')" class="cursor-pointer bg-white p-6 rounded-xl shadow-md border-b-4 border-amber-500 hover:-translate-y-1 transition relative z-10 group">
                    <div class="text-4xl mb-2 text-center">üì±</div>
                    <h3 class="font-bold text-center text-slate-800">RMZWallet</h3>
                    <p class="text-xs text-center text-gray-500 mt-1">Web3 Wallet & Signer</p>
                    <div class="mt-4 text-xs text-amber-600 font-mono bg-amber-50 p-2 rounded text-center opacity-0 group-hover:opacity-100 transition">
                        CAIP-25 Compliance<br>ecash_signAndBroadcast
                    </div>
                </div>
            </div>

            <!-- Detail View for Architecture -->
            <div id="arch-detail-panel" class="bg-white border border-stone-200 rounded-xl p-6 shadow-sm hidden">
                <h3 id="arch-title" class="text-xl font-bold text-slate-800 mb-2"></h3>
                <p id="arch-desc" class="text-gray-600"></p>
                <div id="arch-code" class="mt-4 bg-gray-50 p-3 rounded font-mono text-sm text-slate-600 border border-gray-200"></div>
            </div>
        </section>

        <!-- Section 3: Interactive Transaction Simulation -->
        <section id="simulation" class="bg-white rounded-2xl shadow-sm border border-stone-200 p-6 md:p-8">
            <div class="mb-6">
                <h2 class="text-2xl font-bold text-slate-800 border-l-4 border-green-500 pl-4">Simulador de Flujo de Transacci√≥n</h2>
                <p class="text-gray-600 mt-2">
                    Experimente paso a paso c√≥mo viaja una solicitud de compra desde la dApp hasta la validaci√≥n en Chronik.
                </p>
            </div>

            <!-- Stepper UI -->
            <div class="flex flex-col md:flex-row justify-between items-center mb-8 relative space-y-4 md:space-y-0">
                <div class="hidden md:block absolute top-1/2 left-0 w-full h-1 bg-gray-100 -z-0"></div>
                
                <!-- Steps -->
                <div id="step-1" class="step-box relative z-10 bg-white border-2 border-gray-300 w-full md:w-48 p-3 rounded-lg text-center transition-all duration-300">
                    <div class="font-bold text-sm text-slate-700">1. ListingCard.tsx</div>
                    <div class="text-xs text-gray-500">Usuario inicia compra</div>
                </div>
                <div id="step-2" class="step-box relative z-10 bg-white border-2 border-gray-300 w-full md:w-48 p-3 rounded-lg text-center transition-all duration-300">
                    <div class="font-bold text-sm text-slate-700">2. client.request</div>
                    <div class="text-xs text-gray-500">Env√≠o de OfferID</div>
                </div>
                <div id="step-3" class="step-box relative z-10 bg-white border-2 border-gray-300 w-full md:w-48 p-3 rounded-lg text-center transition-all duration-300">
                    <div class="font-bold text-sm text-slate-700">3. WcWallet.ts</div>
                    <div class="text-xs text-gray-500">Firma Manual</div>
                </div>
                <div id="step-4" class="step-box relative z-10 bg-white border-2 border-gray-300 w-full md:w-48 p-3 rounded-lg text-center transition-all duration-300">
                    <div class="font-bold text-sm text-slate-700">4. Chronik Node</div>
                    <div class="text-xs text-gray-500">Broadcast & Validaci√≥n</div>
                </div>
            </div>

            <!-- Controls & Explanation -->
            <div class="bg-slate-50 rounded-xl p-6 border border-slate-100 flex flex-col items-center text-center">
                <div id="sim-display" class="mb-6 h-24 flex items-center justify-center">
                    <p class="text-lg font-medium text-gray-600">Haga clic en "Iniciar Simulaci√≥n" para ver el proceso.</p>
                </div>
                <div class="flex space-x-4">
                    <button onclick="startSimulation()" class="bg-amber-500 hover:bg-amber-600 text-white font-bold py-2 px-6 rounded-full shadow transition transform hover:scale-105">
                        ‚ñ∂ Iniciar Simulaci√≥n
                    </button>
                    <button onclick="resetSimulation()" class="bg-gray-200 hover:bg-gray-300 text-gray-700 font-bold py-2 px-6 rounded-full shadow transition">
                        ‚Ü∫ Reiniciar
                    </button>
                </div>
            </div>
        </section>

        <!-- Section 4: Deep Dive Cards (Technical Analysis) -->
        <section id="deep-dive" class="grid md:grid-cols-2 gap-8">
            
            <!-- Card 1: Client Side -->
            <div class="bg-white rounded-2xl shadow-sm border border-stone-200 p-6 hover:shadow-md transition">
                <div class="flex items-center mb-4">
                    <div class="w-10 h-10 rounded-full bg-blue-100 flex items-center justify-center text-blue-600 font-bold mr-3">D</div>
                    <h3 class="text-xl font-bold text-slate-800">An√°lisis del Cliente (dApp)</h3>
                </div>
                <div class="space-y-4">
                    <p class="text-gray-600 text-sm">
                        Xolo Legend act√∫a como el proponente de la sesi√≥n. Utiliza un namespace estricto para garantizar la compatibilidad con eCash.
                    </p>
                    <div class="bg-stone-50 p-4 rounded-lg border border-stone-100">
                        <h4 class="text-xs font-bold uppercase text-gray-400 mb-2">Namespace Config</h4>
                        <code class="block text-xs font-mono text-slate-600">
                            namespace: "ecash:mainnet"<br>
                            methods: ["ecash_signAndBroadcast"]<br>
                            storage: "xololegend_wallet_session"
                        </code>
                    </div>
                    <div class="bg-blue-50 p-3 rounded-lg text-sm text-blue-800 flex items-start">
                        <span class="mr-2">üí°</span>
                        <span><strong>Hallazgo Clave:</strong> La sincronizaci√≥n de estado usa `wcOffersStore` para reaccionar al evento `xolos_offer_published` sin recargar la p√°gina.</span>
                    </div>
                </div>
            </div>

            <!-- Card 2: Wallet Side -->
            <div class="bg-white rounded-2xl shadow-sm border border-stone-200 p-6 hover:shadow-md transition">
                <div class="flex items-center mb-4">
                    <div class="w-10 h-10 rounded-full bg-amber-100 flex items-center justify-center text-amber-600 font-bold mr-3">W</div>
                    <h3 class="text-xl font-bold text-slate-800">An√°lisis del Proveedor (Wallet)</h3>
                </div>
                <div class="space-y-4">
                    <p class="text-gray-600 text-sm">
                        RMZWallet centraliza la l√≥gica de firma y gestiona eventos offline mediante un sistema de cola inteligente.
                    </p>
                    <div class="bg-stone-50 p-4 rounded-lg border border-stone-100">
                        <h4 class="text-xs font-bold uppercase text-gray-400 mb-2">Cola de Ofertas (OfferQueue)</h4>
                        <div class="w-full bg-gray-200 rounded-full h-2.5 mb-2">
                            <div class="bg-amber-500 h-2.5 rounded-full" style="width: 75%"></div>
                        </div>
                        <p class="text-xs text-gray-500">Las ofertas creadas offline se encolan y propagan autom√°ticamente al reconectar.</p>
                    </div>
                    <div class="bg-amber-50 p-3 rounded-lg text-sm text-amber-800 flex items-start">
                        <span class="mr-2">üõ°Ô∏è</span>
                        <span><strong>Seguridad:</strong> El usuario debe aprobar f√≠sicamente cada firma Schnorr. Las llaves privadas nunca abandonan el entorno del wallet.</span>
                    </div>
                </div>
            </div>

        </section>

        <!-- Footer -->
        <footer class="text-center py-8 border-t border-gray-200">
            <p class="text-gray-500 text-sm">¬© 2026 xolosArmy Network Research Dept.</p>
            <p class="text-xs text-gray-400 mt-1">Estado: Operativo y Verificado ‚Ä¢ Protocolo: eCAIP-25</p>
        </footer>

    </main>

    <!-- Application Structure Plan: 
         The app uses a Dashboard > Interactive Flow > Deep Dive structure. 
         1. Dashboard provides the high-level summary and success metrics (Radar Chart).
         2. Architecture Map creates a mental model of the system components.
         3. Simulation (Stepper) allows the user to 'feel' the time and logic of a transaction without technical jargon overload.
         4. Deep Dive cards isolate the complexity of Client vs Wallet logic for clarity.
    -->

    <!-- Visualization & Content Choices:
         - Radar Chart: Chosen to compare multi-dimensional attributes (Security, Speed, UX) of the old vs new system.
         - Stepper (HTML/CSS): Used instead of a static flowchart to show the *process* over time.
         - Interactive Architecture (Grid/Flex): Replaces complex static diagrams, allowing user-driven discovery of component responsibilities.
         - Color Coding: Blue for Client, Amber for Wallet, consistent across all visualizations.
    -->

    <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->

    <script>
        // --- Data & State ---
        const archData = {
            dapp: {
                title: "Xolo Legend (Cliente)",
                desc: "Gestiona la interfaz de usuario, listado de ofertas y recuperaci√≥n de sesiones. No posee llaves privadas.",
                code: "WcBridge.tsx -> client.request({ topic, chainId, request: { method: 'ecash_sign...' } })"
            },
            relay: {
                title: "WalletConnect Cloud (Relay)",
                desc: "Infraestructura de mensajer√≠a agn√≥stica. Garantiza la entrega de mensajes JSON-RPC encriptados entre pares desconectados.",
                code: "wss://relay.walletconnect.com [Encrypted Payload]"
            },
            wallet: {
                title: "RMZWallet / Tonalli (Proveedor)",
                desc: "Custodia las llaves. Decodifica peticiones, solicita aprobaci√≥n del usuario y transmite a la red eCash.",
                code: "WcWallet.ts -> approveSession() -> signTransaction() -> chronik.broadcastTx()"
            }
        };

        // --- Charts Implementation ---
        document.addEventListener('DOMContentLoaded', function() {
            const ctx = document.getElementById('comparisonChart').getContext('2d');
            new Chart(ctx, {
                type: 'radar',
                data: {
                    labels: ['Seguridad', 'Persistencia', 'Velocidad UX', 'Descentralizaci√≥n', 'Complejidad Dev'],
                    datasets: [{
                        label: 'Legacy (Callbacks)',
                        data: [60, 20, 40, 50, 80],
                        fill: true,
                        backgroundColor: 'rgba(148, 163, 184, 0.2)', // Slate
                        borderColor: 'rgb(148, 163, 184)',
                        pointBackgroundColor: 'rgb(148, 163, 184)',
                    }, {
                        label: 'WC v2 (Actual)',
                        data: [95, 90, 85, 90, 40],
                        fill: true,
                        backgroundColor: 'rgba(245, 158, 11, 0.2)', // Amber
                        borderColor: 'rgb(245, 158, 11)',
                        pointBackgroundColor: 'rgb(245, 158, 11)',
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        r: {
                            angleLines: { display: true },
                            suggestedMin: 0,
                            suggestedMax: 100
                        }
                    },
                    plugins: {
                        legend: { position: 'bottom' }
                    }
                }
            });
        });

        // --- Interaction Logic: Architecture ---
        function showArchDetail(key) {
            const panel = document.getElementById('arch-detail-panel');
            const title = document.getElementById('arch-title');
            const desc = document.getElementById('arch-desc');
            const code = document.getElementById('arch-code');
            
            const data = archData[key];
            
            title.textContent = data.title;
            desc.textContent = data.desc;
            code.textContent = data.code;
            
            panel.classList.remove('hidden');
            panel.classList.add('animate-fade-in-up');
            
            // Highlight effect on the clicked card could be added here via class toggling if needed
        }

        // --- Interaction Logic: Simulation ---
        let simInterval;
        const steps = ['step-1', 'step-2', 'step-3', 'step-4'];
        const messages = [
            "Usuario hace clic en 'Comprar' en la dApp...",
            "dApp env√≠a solicitud RPC (ecash_sign) con offerId...",
            "Wallet recibe alerta. Usuario aprueba firma Schnorr...",
            "Transacci√≥n transmitida a Chronik. dApp recibe confirmaci√≥n."
        ];

        function startSimulation() {
            resetSimulation();
            let currentStep = 0;
            const display = document.getElementById('sim-display');
            
            // Disable button
            // (Implementation omitted for brevity, logic handles visual flow)

            function runStep() {
                if (currentStep >= steps.length) {
                    display.innerHTML = '<p class="text-green-600 font-bold text-xl">¬°Transacci√≥n Confirmada! ‚úÖ</p>';
                    return;
                }

                // Highlight current step
                document.getElementById(steps[currentStep]).classList.add('step-active');
                
                // Update text
                display.innerHTML = `<p class="text-lg font-medium text-slate-800 animate-pulse">${messages[currentStep]}</p>`;

                // Remove highlight from previous if applicable (optional, keeping trail for now)
                if(currentStep > 0) {
                     document.getElementById(steps[currentStep-1]).classList.remove('step-active');
                     document.getElementById(steps[currentStep-1]).classList.add('bg-gray-50', 'text-gray-400'); // Dim previous
                }

                currentStep++;
                simInterval = setTimeout(runStep, 1500); // 1.5s per step
            }

            runStep();
        }

        function resetSimulation() {
            clearTimeout(simInterval);
            steps.forEach(id => {
                const el = document.getElementById(id);
                el.classList.remove('step-active', 'bg-gray-50', 'text-gray-400');
            });
            document.getElementById('sim-display').innerHTML = '<p class="text-lg font-medium text-gray-600">Haga clic en "Iniciar Simulaci√≥n" para ver el proceso.</p>';
        }

        // Mobile Menu Toggle
        document.getElementById('mobile-menu-btn').addEventListener('click', () => {
            const menu = document.getElementById('mobile-menu');
            menu.classList.toggle('hidden');
        });

    </script>
</body>
</html>

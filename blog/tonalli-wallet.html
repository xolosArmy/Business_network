<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tonalli Wallet: Technical Milestone Report</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #fafaf9; color: #44403c; }
        .chart-container { position: relative; width: 100%; max-width: 400px; margin: 0 auto; height: 300px; max-height: 300px; }
        .step-active { border-color: #f97316; background-color: #ffedd5; color: #c2410c; }
        .step-inactive { border-color: #e7e5e4; background-color: #ffffff; color: #a8a29e; }
        .utxo-box { transition: all 0.3s ease; }
    </style>
</head>
<body class="bg-stone-50 text-stone-800 antialiased selection:bg-orange-200 selection:text-orange-900">

    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        
        <header class="mb-10 text-center sm:text-left border-b border-stone-200 pb-6">
            <h1 class="text-3xl sm:text-4xl font-bold text-stone-900 tracking-tight">Tonalli Wallet <span class="text-orange-600">Milestone Report</span></h1>
            <p class="mt-2 text-lg text-stone-600 max-w-3xl">
                Interactive technical analysis of the xolosArmy Network's new wallet functionalities, featuring SLP NFT1 Groups, atomic swaps, and sovereign infrastructure.
            </p>
        </header>

        <section class="mb-12 bg-stone-900 rounded-2xl overflow-hidden shadow-2xl border border-stone-800">
            <div class="p-4 bg-stone-800 border-b border-stone-700 flex justify-between items-center">
                <span class="text-orange-500 font-bold text-xs uppercase tracking-widest flex items-center">
                    <span class="flex h-2 w-2 rounded-full bg-orange-500 mr-2 animate-pulse"></span>
                    xolosArmy Podcast: Latest Episode
                </span>
                <span class="text-stone-400 text-xs font-mono">ID: LRURmCjBQ3c</span>
            </div>
            <div class="aspect-video w-full">
                <iframe 
                    class="w-full h-full"
                    src="https://www.youtube.com/embed/LRURmCjBQ3c?si=d9OyXVWDTa1hN0Tc&autoplay=1&mute=1&rel=0" 
                    title="xolosArmy Podcast" 
                    frameborder="0" 
                    allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" 
                    allowfullscreen>
                </iframe>
            </div>
        </section>

        <div class="grid grid-cols-1 lg:grid-cols-12 gap-8">

            <div class="lg:col-span-4 flex flex-col gap-8">
                
                <section class="bg-white rounded-xl shadow-sm border border-stone-200 p-6">
                    <h2 class="text-xl font-bold text-stone-800 mb-2">1. Official NFT1 Group</h2>
                    <p class="text-sm text-stone-500 mb-4">
                        The foundation of the ecosystem is the "RMZState" Parent Token. This token acts as the verified issuer for all subsequent child NFTs.
                    </p>
                    
                    <div class="space-y-3 text-sm">
                        <div class="flex justify-between items-center py-2 border-b border-stone-100">
                            <span class="font-medium text-stone-500">Ticker</span>
                            <span class="font-mono bg-stone-100 px-2 py-1 rounded text-stone-700">RMZState</span>
                        </div>
                        <div class="flex flex-col py-2 border-b border-stone-100">
                            <span class="font-medium text-stone-500 mb-1">Token ID (Hash)</span>
                            <span class="font-mono text-xs text-stone-400 break-all">bf8e0b5cd60fe4d6354c662b28542e0f3c3d69941eb039426d65bcdb7fe9f48c</span>
                        </div>
                        <div class="flex justify-between items-center py-2">
                            <span class="font-medium text-stone-500">Genesis Supply</span>
                            <span class="font-bold text-orange-600">1,000 Tokens</span>
                        </div>
                    </div>

                    <div class="mt-6">
                        <h3 class="text-xs font-semibold uppercase tracking-wider text-stone-400 mb-2 text-center">Supply Allocation</h3>
                        <div class="chart-container">
                            <canvas id="supplyChart"></canvas>
                        </div>
                        <p class="text-xs text-center text-stone-400 mt-2">1 Token = 1 Potential Child NFT</p>
                    </div>
                </section>

                <section class="bg-white rounded-xl shadow-sm border border-stone-200 p-6">
                    <h2 class="text-xl font-bold text-stone-800 mb-4">4. Infrastructure & Sovereignty</h2>
                    <p class="text-sm text-stone-500 mb-4">
                        The wallet prioritizes self-hosted and decentralized services to ensure censorship resistance.
                    </p>
                    <div class="grid grid-cols-1 gap-3">
                        <div class="flex items-start p-3 bg-stone-50 rounded-lg">
                            <div class="text-2xl mr-3">‚ö°</div>
                            <div>
                                <h4 class="font-semibold text-stone-800 text-sm">Chronik Indexer</h4>
                                <p class="text-xs text-stone-500">Sovereign instance at chronik.xolosarmy.xyz for transaction verification.</p>
                            </div>
                        </div>
                        <div class="flex items-start p-3 bg-stone-50 rounded-lg">
                            <div class="text-2xl mr-3">üì¶</div>
                            <div>
                                <h4 class="font-semibold text-stone-800 text-sm">IPFS Storage</h4>
                                <p class="text-xs text-stone-500">Metadata pinned via Pinata. Accessible via local/public gateways.</p>
                            </div>
                        </div>
                    </div>
                </section>
            </div>

            <div class="lg:col-span-8 flex flex-col gap-8">

                <section class="bg-white rounded-xl shadow-sm border border-stone-200 p-6 sm:p-8">
                    <div class="flex flex-col md:flex-row justify-between items-start md:items-center mb-6">
                        <div>
                            <h2 class="text-2xl font-bold text-stone-800">2. Mint Pass Mechanics</h2>
                            <p class="text-stone-500 text-sm mt-1">Simulate the "Burn-to-Mint" logic implemented in <code class="bg-stone-100 px-1 rounded text-xs">slpNftTxBuilder.ts</code>.</p>
                        </div>
                        <div class="mt-4 md:mt-0 bg-orange-100 text-orange-800 text-xs font-bold px-3 py-1 rounded-full uppercase tracking-wide">
                            Interactive Demo
                        </div>
                    </div>

                    <div class="bg-stone-50 rounded-xl p-6 border border-stone-200">
                        <p class="text-sm text-stone-600 mb-4">
                            <strong>Logic:</strong> To create a new Child NFT, exactly <strong>1 Parent Token</strong> must be consumed. If a UTXO contains >1 token, a "Fanout" transaction splits it first.
                        </p>

                        <div class="grid grid-cols-1 sm:grid-cols-3 gap-4 text-center mb-6">
                            <div class="bg-white p-4 rounded-lg shadow-sm border border-stone-100">
                                <div class="text-xs text-stone-400 uppercase font-semibold">Wallet Balance</div>
                                <div id="sim-balance" class="text-3xl font-bold text-stone-800">10</div>
                                <div class="text-xs text-stone-500">Parent Tokens</div>
                            </div>
                            <div class="flex items-center justify-center">
                                <div class="text-stone-300 text-2xl">‚ûî</div>
                            </div>
                            <div class="bg-white p-4 rounded-lg shadow-sm border border-stone-100">
                                <div class="text-xs text-stone-400 uppercase font-semibold">Minted Collection</div>
                                <div id="sim-minted" class="text-3xl font-bold text-orange-600">0</div>
                                <div class="text-xs text-stone-500">Child NFTs</div>
                            </div>
                        </div>

                        <div class="mb-4">
                            <div class="flex justify-between text-xs text-stone-400 mb-1">
                                <span>UTXO Pool Visualization</span>
                                <span id="fanout-status" class="hidden text-orange-500 font-bold">‚ö†Ô∏è Fanout Split Required...</span>
                            </div>
                            <div id="utxo-container" class="h-16 bg-stone-200 rounded-lg flex items-center px-2 gap-1 overflow-hidden relative">
                                </div>
                        </div>

                        <div class="flex justify-center">
                            <button id="btn-mint" class="bg-stone-900 hover:bg-orange-600 text-white font-medium py-2 px-6 rounded-lg transition-colors shadow-lg active:scale-95 transform duration-150 flex items-center">
                                <span>Execute Mint Transaction</span>
                            </button>
                            <button id="btn-reset" class="ml-4 text-stone-400 hover:text-stone-600 font-medium text-sm underline">
                                Reset
                            </button>
                        </div>
                        <div id="sim-log" class="mt-4 text-xs font-mono text-stone-400 text-center h-4">Waiting for transaction...</div>
                    </div>
                </section>

                <section class="bg-white rounded-xl shadow-sm border border-stone-200 p-6 sm:p-8">
                    <div class="mb-6">
                        <h2 class="text-2xl font-bold text-stone-800">3. Atomic NFT Swaps</h2>
                        <p class="text-stone-500 text-sm mt-1">
                            Integrated "Oneshot" DEX powered by <code class="bg-stone-100 px-1 rounded text-xs">ecash-agora</code>. No orderbook, purely P2P.
                        </p>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                        <div class="space-y-4">
                            <h3 class="font-semibold text-stone-700 text-sm uppercase tracking-wide">The Swap Flow</h3>
                            
                            <div id="step-1" class="step-card border-l-4 p-4 rounded-r-lg cursor-pointer transition-all step-active" onclick="setSwapStep(1)">
                                <h4 class="font-bold text-sm">1. Seller Creates Offer</h4>
                                <p class="text-xs mt-1">Seller lists NFT for XEC price. "Oneshot" offer created.</p>
                            </div>

                            <div id="step-2" class="step-card border-l-4 p-4 rounded-r-lg cursor-pointer transition-all step-inactive" onclick="setSwapStep(2)">
                                <h4 class="font-bold text-sm">2. Share Offer ID</h4>
                                <p class="text-xs mt-1">No central server. Seller shares <code>txid:vout</code> string.</p>
                            </div>

                            <div id="step-3" class="step-card border-l-4 p-4 rounded-r-lg cursor-pointer transition-all step-inactive" onclick="setSwapStep(3)">
                                <h4 class="font-bold text-sm">3. Buyer Previews</h4>
                                <p class="text-xs mt-1">Buyer pastes ID. Wallet parses raw tx data to verify content.</p>
                            </div>

                            <div id="step-4" class="step-card border-l-4 p-4 rounded-r-lg cursor-pointer transition-all step-inactive" onclick="setSwapStep(4)">
                                <h4 class="font-bold text-sm">4. Atomic Execution</h4>
                                <p class="text-xs mt-1">Buyer signs. Swap happens in one block. Risk-free.</p>
                            </div>
                        </div>

                        <div class="bg-stone-900 rounded-xl p-6 text-stone-300 flex flex-col justify-center relative overflow-hidden">
                            <div class="absolute top-0 right-0 p-4 opacity-10">
                                <span class="text-6xl">‚áÑ</span>
                            </div>
                            <div id="swap-detail-content">
                                <h4 class="text-orange-400 font-bold text-lg mb-2">Step 1: Offer Creation</h4>
                                <p class="text-sm leading-relaxed">
                                    The seller defines a price in XEC. The wallet constructs a partially signed transaction (SIGHASH_SINGLE | ANYONECANPAY) containing the NFT input and the required XEC output.
                                </p>
                                <div class="mt-4 p-3 bg-stone-800 rounded border border-stone-700 font-mono text-xs text-green-400">
                                    > Generating Partial Tx...<br>
                                    > Input: NFT #402<br>
                                    > Output: 1000 XEC to Seller<br>
                                    > Status: Waiting for Buyer
                                </div>
                            </div>
                        </div>
                    </div>
                </section>

            </div>
        </div>
    </div>

    <script>
        // --- 1. Supply Chart (Chart.js) ---
        document.addEventListener('DOMContentLoaded', function() {
            const ctx = document.getElementById('supplyChart').getContext('2d');
            
            const supplyChart = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: ['Reserved/Distributed', 'Mintable Supply'],
                    datasets: [{
                        data: [150, 850],
                        backgroundColor: ['#d6d3d1', '#ea580c'],
                        borderWidth: 0,
                        hoverOffset: 4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    cutout: '70%',
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: {
                                font: { family: "'Inter', sans-serif", size: 12 },
                                color: '#78716c'
                            }
                        },
                        tooltip: {
                            backgroundColor: '#292524',
                            titleFont: { family: "'Inter', sans-serif" },
                            bodyFont: { family: "'Inter', sans-serif" }
                        }
                    }
                }
            });

            // --- 2. Mint Pass Simulator Logic ---
            let parentTokens = 10;
            let mintedChildren = 0;
            const utxoContainer = document.getElementById('utxo-container');
            const balanceEl = document.getElementById('sim-balance');
            const mintedEl = document.getElementById('sim-minted');
            const logEl = document.getElementById('sim-log');

            function renderUTXOs() {
                utxoContainer.innerHTML = '';
                for (let i = 0; i < parentTokens; i++) {
                    const div = document.createElement('div');
                    div.className = 'utxo-box w-8 h-10 bg-stone-800 rounded shadow-sm flex-shrink-0';
                    div.title = "Parent Token UTXO";
                    utxoContainer.appendChild(div);
                }
            }

            document.getElementById('btn-mint').addEventListener('click', () => {
                if (parentTokens > 0) {
                    logEl.textContent = "Selecting 1 Parent Token Input...";
                    const lastToken = utxoContainer.lastElementChild;
                    if(lastToken) {
                        lastToken.classList.remove('bg-stone-800');
                        lastToken.classList.add('bg-red-500', 'scale-0');
                        setTimeout(() => {
                            parentTokens--;
                            mintedChildren++;
                            balanceEl.textContent = parentTokens;
                            mintedEl.textContent = mintedChildren;
                            renderUTXOs();
                            logEl.textContent = "Transaction Confirmed: 1 Parent Burned, 1 Child Minted.";
                            logEl.className = "mt-4 text-xs font-mono text-green-600 text-center h-4 font-bold";
                        }, 400);
                    }
                } else {
                    logEl.textContent = "Error: No Parent Tokens Remaining.";
                    logEl.className = "mt-4 text-xs font-mono text-red-600 text-center h-4 font-bold";
                }
            });

            document.getElementById('btn-reset').addEventListener('click', () => {
                parentTokens = 10;
                mintedChildren = 0;
                balanceEl.textContent = parentTokens;
                mintedEl.textContent = mintedChildren;
                logEl.textContent = "Waiting for transaction...";
                logEl.className = "mt-4 text-xs font-mono text-stone-400 text-center h-4";
                renderUTXOs();
            });

            renderUTXOs();
        });

        // --- 3. Atomic Swap Stepper Logic ---
        const swapDetails = [
            {
                title: "Step 1: Offer Creation",
                text: "The seller defines a price in XEC. The wallet constructs a partially signed transaction (SIGHASH_SINGLE | ANYONECANPAY) containing the NFT input and the required XEC output.",
                code: "> Generating Partial Tx...<br>> Input: NFT #402<br>> Output: 1000 XEC to Seller<br>> Status: Waiting for Buyer"
            },
            {
                title: "Step 2: Share Offer ID",
                text: "Unlike centralized marketplaces, there is no database. The offer exists only as a transaction hash and output index (txid:vout). This string is shared via chat, social media, or a simple listing site.",
                code: "> Offer ID: 7f3b...a1:0<br>> Copying to clipboard...<br>> Status: Shared off-chain"
            },
            {
                title: "Step 3: Buyer Previews",
                text: "The buyer pastes the Offer ID into their wallet. The wallet queries the Chronik indexer to fetch the raw transaction data, verifies the NFT metadata, and checks the price tag.",
                code: "> Fetching tx 7f3b...<br>> Decoded: NFT 'Xolo #402'<br>> Price: 1000 XEC<br>> Verify: VALID"
            },
            {
                title: "Step 4: Atomic Execution",
                text: "The buyer attaches their XEC payment inputs to the transaction and signs it. The transaction is broadcast. The swap happens atomically: either the Seller gets paid AND Buyer gets NFT, or nothing happens.",
                code: "> Attaching Payment Inputs...<br>> Signing Tx...<br>> Broadcast Success!<br>> New Owner: You"
            }
        ];

        function setSwapStep(stepNum) {
            for (let i = 1; i <= 4; i++) {
                const el = document.getElementById(`step-${i}`);
                if (i === stepNum) {
                    el.classList.remove('step-inactive', 'border-stone-200');
                    el.classList.add('step-active', 'border-l-4');
                } else {
                    el.classList.add('step-inactive', 'border-stone-200');
                    el.classList.remove('step-active');
                }
            }
            const content = swapDetails[stepNum - 1];
            const detailPanel = document.getElementById('swap-detail-content');
            detailPanel.style.opacity = '0';
            setTimeout(() => {
                detailPanel.innerHTML = `
                    <h4 class="text-orange-400 font-bold text-lg mb-2">${content.title}</h4>
                    <p class="text-sm leading-relaxed">${content.text}</p>
                    <div class="mt-4 p-3 bg-stone-800 rounded border border-stone-700 font-mono text-xs text-green-400">
                        ${content.code}
                    </div>
                `;
                detailPanel.style.opacity = '1';
            }, 200);
        }
    </script>
</body>
</html>

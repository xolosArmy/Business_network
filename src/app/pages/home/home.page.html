<ion-header>
  <ion-toolbar color="light">
    <ion-title>RMZ Wallet</ion-title>
    <ion-buttons slot="end">
      <ion-chip color="medium" outline="true">
        <ion-icon name="radio-outline"></ion-icon>
        <ion-label>Chronik</ion-label>
        <ion-badge [color]="connected ? 'success' : 'warning'">{{ connected ? 'Online' : 'Reconectando' }}</ion-badge>
      </ion-chip>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true" class="rmz-bg">
  <ion-grid fixed>

    <!-- Si no hay cartera, onboarding simple -->
    <ng-container *ngIf="!wallet?.address; else walletDashboard">
      <ion-row>
        <ion-col size="12">
          <ion-card>
            <ion-card-header>
              <ion-card-title>Gestión de Cartera</ion-card-title>
              <ion-card-subtitle>Genera una nueva cartera para comenzar a recibir eCash.</ion-card-subtitle>
            </ion-card-header>
            <ion-card-content>
              <ion-button color="rmz" expand="block" size="large" (click)="onCrear()" [disabled]="loading">
                <ion-icon name="sparkles-outline" slot="start"></ion-icon>
                Crear cartera
              </ion-button>
              <ion-text color="medium">
                <p class="mt-2">Xolín cuidará tu primer recibo y te avisará al instante.</p>
              </ion-text>
            </ion-card-content>
          </ion-card>
        </ion-col>
      </ion-row>
    </ng-container>

    <!-- Dashboard cuando ya existe cartera -->
    <ng-template #walletDashboard>
      <ion-row>
        <ion-col size="12" sizeMd="6">
          <ion-card class="rmz-hero">
            <ion-card-header>
              <ion-card-subtitle>Saldo disponible</ion-card-subtitle>
              <ion-card-title class="rmz-balance">
                {{ (balanceXec | async) ?? 0 | number:'1.2-2' }} XEC
              </ion-card-title>
              <ion-card-subtitle class="rmz-secondary">
                {{ (balanceRmz | async) ?? 0 | number:'1.0-4' }} RMZ
              </ion-card-subtitle>
            </ion-card-header>
            <ion-card-content>
              <div class="rmz-actions">
                <ion-button color="rmz" (click)="onEnviar()" [disabled]="loading">
                  <ion-icon slot="start" name="arrow-up-circle-outline"></ion-icon>
                  Enviar
                </ion-button>
                <ion-button color="dark" fill="outline" (click)="onRecibir()" [disabled]="loading">
                  <ion-icon slot="start" name="arrow-down-circle-outline"></ion-icon>
                  Recibir
                </ion-button>
              </div>
              <ion-item lines="none" class="rmz-token-balance">
                <ion-icon slot="start" name="logo-buffer" color="rmz"></ion-icon>
                <ion-label>
                  <h3>Saldo RMZ</h3>
                  <p>{{ (balanceRmz | async) ?? 0 | number:'1.0-4' }} RMZ</p>
                </ion-label>
              </ion-item>
            </ion-card-content>
          </ion-card>
        </ion-col>

        <ion-col size="12" sizeMd="6">
          <ion-card>
            <ion-card-header>
              <ion-card-subtitle>Tu dirección</ion-card-subtitle>
              <ion-card-title class="break-all">{{ wallet?.address || '—' }}</ion-card-title>
            </ion-card-header>
            <ion-card-content>
              <ion-button size="small" fill="outline" (click)="copiar(wallet?.address)">
                <ion-icon name="copy-outline" slot="start"></ion-icon>
                Copiar
              </ion-button>
              <ion-button size="small" fill="clear" (click)="mostrarQR()">
                <ion-icon name="qr-code-outline" slot="start"></ion-icon>
                QR
              </ion-button>
            </ion-card-content>
          </ion-card>
        </ion-col>
      </ion-row>

      <ion-row>
        <ion-col size="12">
          <ion-card>
            <ion-card-header>
              <ion-card-title>Actividad</ion-card-title>
            </ion-card-header>

            <!-- Estado vacío -->
            <ion-list *ngIf="(txs | async)?.length === 0">
              <ion-item lines="none">
                <ion-label>
                  <h2>Xolín</h2>
                  <p>Sin movimientos todavía. Cuando llegue tu primera TX, Xolín te avisará al instante.</p>
                </ion-label>
              </ion-item>
            </ion-list>

            <!-- Lista de transacciones -->
            <ion-list *ngIf="(txs | async)?.length">
              <ion-item *ngFor="let t of (txs | async)" detail="true" (click)="abrirTx(t)">
                <ion-avatar slot="start">
                  <ion-icon [name]="t.type === 'send' ? 'swap-vertical-outline' : 'download-outline'"></ion-icon>
                </ion-avatar>
                <ion-label>
                  <h3>{{ t.type === 'send' ? 'Envío' : 'Recepción' }} • {{ t.amount | number:'1.2-8' }} XEC</h3>
                  <p>{{ t.time | date:'short' }} • {{ t.confirmed ? 'Confirmada' : 'Pendiente' }}</p>
                </ion-label>
                <ion-badge [color]="t.confirmed ? 'success' : 'warning'">{{ t.confirmed ? 'OK' : '...' }}</ion-badge>
              </ion-item>
            </ion-list>
          </ion-card>
        </ion-col>
      </ion-row>
    </ng-template>

  </ion-grid>
</ion-content>
